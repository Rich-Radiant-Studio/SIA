{"version":3,"file":"sandbox.js","names":["iframeGenerator","recoverEventListeners","recoverDocumentListeners","insertScriptToIframe","patchEventTimeStamp","syncUrlToWindow","syncUrlToIframe","clearInactiveAppUrl","createWujieWebComponent","clearChild","getPatchStyleElements","renderElementToContainer","renderTemplateToShadowRoot","renderTemplateToIframe","initRenderIframeAndContainer","removeLoading","proxyGenerator","localGenerator","getPlugins","getPresetLoaders","removeEventListener","idToSandboxCacheMap","addSandboxCacheWithWujie","deleteWujieById","rawElementAppendChild","rawDocumentQuerySelector","EventBus","appEventObjMap","isFunction","wujieSupport","appRouteParse","requestIdleCallback","getAbsolutePath","eventTrigger","WUJIE_DATA_ATTACH_CSS_FLAG","Wujie","options","_classCallCheck","_defineProperty","WeakMap","window","__POWERED_BY_WUJIE__","inject","__WUJIE","idToSandboxMap","mainHostPath","location","protocol","host","name","url","attrs","fiber","degradeAttrs","degrade","lifecycles","plugins","id","bus","provide","styleSheetElements","execQueue","iframeAddEventListeners","iframeOnEvents","_appRouteParse","urlElement","appHostPath","appRoutePath","iframe","_localGenerator","proxyDocument","proxyLocation","_proxyGenerator","proxyWindow","proxy","_createClass","key","value","_active","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this","sync","el","template","props","alive","prefix","fetch","replace","iframeWindow","iframeFetch","iframeBody","_initRenderIframeAndC","container","_iframeBody","wrap","_callee$","_context","prev","next","hrefFlag","activeFlag","iframeReady","contentWindow","input","init","href","execFlag","call","document","onunload","unmount","contentDocument","replaceChild","documentElement","abrupt","shadowRoot","patchCssRules","stop","active","_x","apply","arguments","callback","_this2","_start","_callee2","getExternalScripts","_this3","scriptResultList","beforeScriptResultList","afterScriptResultList","syncScriptResultList","asyncScriptResultList","deferScriptResultList","domContentLoadedTrigger","domLoadedTrigger","_callee2$","_context2","sent","forEach","scriptResult","defer","push","async","beforeScriptResult","concat","contentPromise","then","content","_objectSpread","mount","_this3$execQueue$shif","shift","afterScriptResult","_this3$execQueue$shif2","__WUJIE_UNMOUNT","Promise","resolve","_this3$execQueue$shif3","start","_x2","_this$execQueue$shift","mountFlag","__WUJIE_MOUNT","_this$lifecycles","_this$lifecycles$befo","_this$lifecycles2","_this$lifecycles2$aft","beforeMount","afterMount","_this$lifecycles3","_this$lifecycles3$act","activated","_unmount","_callee3","_this$lifecycles4","_this$lifecycles4$dea","_this$lifecycles5","_this$lifecycles5$bef","_this$lifecycles6","_this$lifecycles6$aft","_this$bus","_callee3$","_context3","deactivated","beforeUnmount","afterUnmount","$clear","head","body","_destroy","_callee4","_this$iframe$parentNo","_iframeWindow","_callee4$","_context4","elementEventCacheMap","__WUJIE_EVENTLISTENER__","o","type","listener","parentNode","removeChild","destroy","rebuildStyleSheets","_this4","length","styleSheetElement","hasAttribute","_getPatchStyleElement","Array","from","querySelectorAll","map","sheet","_getPatchStyleElement2","_slicedToArray","hostStyleSheetElement","fontStyleSheetElement","appendChild","setAttribute","default"],"sources":["../src/sandbox.ts"],"sourcesContent":["import {\n  iframeGenerator,\n  recoverEventListeners,\n  recoverDocumentListeners,\n  insertScriptToIframe,\n  patchEventTimeStamp,\n} from \"./iframe\";\nimport { syncUrlToWindow, syncUrlToIframe, clearInactiveAppUrl } from \"./sync\";\nimport {\n  createWujieWebComponent,\n  clearChild,\n  getPatchStyleElements,\n  renderElementToContainer,\n  renderTemplateToShadowRoot,\n  renderTemplateToIframe,\n  initRenderIframeAndContainer,\n  removeLoading,\n} from \"./shadow\";\nimport { proxyGenerator, localGenerator } from \"./proxy\";\nimport { ScriptResultList } from \"./entry\";\nimport { getPlugins, getPresetLoaders } from \"./plugin\";\nimport { removeEventListener } from \"./effect\";\nimport {\n  SandboxCache,\n  idToSandboxCacheMap,\n  addSandboxCacheWithWujie,\n  deleteWujieById,\n  rawElementAppendChild,\n  rawDocumentQuerySelector,\n} from \"./common\";\nimport { EventBus, appEventObjMap, EventObj } from \"./event\";\nimport { isFunction, wujieSupport, appRouteParse, requestIdleCallback, getAbsolutePath, eventTrigger } from \"./utils\";\nimport { WUJIE_DATA_ATTACH_CSS_FLAG } from \"./constant\";\nimport { plugin, ScriptObjectLoader, loadErrorHandler } from \"./index\";\n\nexport type lifecycle = (appWindow: Window) => any;\ntype lifecycles = {\n  beforeLoad: lifecycle;\n  beforeMount: lifecycle;\n  afterMount: lifecycle;\n  beforeUnmount: lifecycle;\n  afterUnmount: lifecycle;\n  activated: lifecycle;\n  deactivated: lifecycle;\n  loadError: loadErrorHandler;\n};\n/**\n * 基于 Proxy和iframe 实现的沙箱\n */\nexport default class Wujie {\n  public id: string;\n  /** 激活时路由地址 */\n  public url: string;\n  /** 子应用保活 */\n  public alive: boolean;\n  /** window代理 */\n  public proxy: WindowProxy;\n  /** document代理 */\n  public proxyDocument: Object;\n  /** location代理 */\n  public proxyLocation: Object;\n  /** 事件中心 */\n  public bus: EventBus;\n  /** 容器 */\n  public el: HTMLElement;\n  /** js沙箱 */\n  public iframe: HTMLIFrameElement;\n  /** css沙箱 */\n  public shadowRoot: ShadowRoot;\n  /** 子应用的template */\n  public template: string;\n  /** 子应用代码替换钩子 */\n  public replace: (code: string) => string;\n  /** 子应用自定义fetch */\n  public fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\n  /** 子应用的生命周期 */\n  public lifecycles: lifecycles;\n  /** 子应用的插件 */\n  public plugins: Array<plugin>;\n  /** js沙箱ready态 */\n  public iframeReady: Promise<void>;\n  /** 子应用预加载态 */\n  public preload: Promise<void>;\n  /** 降级时渲染iframe的属性 */\n  public degradeAttrs: { [key: string]: any };\n  /** 子应用js执行队列 */\n  public execQueue: Array<Function>;\n  /** 子应用执行过标志 */\n  public execFlag: boolean;\n  /** 子应用激活标志 */\n  public activeFlag: boolean;\n  /** 子应用mount标志 */\n  public mountFlag: boolean;\n  /** 路由同步标志 */\n  public sync: boolean;\n  /** 子应用短路径替换，路由同步时生效 */\n  public prefix: { [key: string]: string };\n  /** 子应用跳转标志 */\n  public hrefFlag: boolean;\n  /** 子应用采用fiber模式执行 */\n  public fiber: boolean;\n  /** 子应用降级标志 */\n  public degrade: boolean;\n  /** 子应用降级document */\n  public document: Document;\n  /** 子应用styleSheet元素 */\n  public styleSheetElements: Array<HTMLLinkElement | HTMLStyleElement>;\n  /** 子应用head元素 */\n  public head: HTMLHeadElement;\n  /** 子应用body元素 */\n  public body: HTMLBodyElement;\n  /** 子应用dom监听事件留存，当降级时用于保存元素事件 */\n  public elementEventCacheMap: WeakMap<\n    Node,\n    Array<{ type: string; handler: EventListenerOrEventListenerObject; options: any }>\n  > = new WeakMap();\n  /** 子应用window监听事件 */\n  public iframeAddEventListeners?: Array<string>;\n  /** 子应用iframe on事件 */\n  public iframeOnEvents?: Array<string>;\n\n  /** $wujie对象，提供给子应用的接口 */\n  public provide: {\n    bus: EventBus;\n    shadowRoot?: ShadowRoot;\n    props?: { [key: string]: any };\n    location?: Object;\n  };\n\n  /** 子应用嵌套场景，父应用传递给子应用的数据 */\n  public inject: {\n    idToSandboxMap: Map<String, SandboxCache>;\n    appEventObjMap: Map<String, EventObj>;\n    mainHostPath: string;\n  };\n\n  /** 激活子应用\n   * 1、同步路由\n   * 2、动态修改iframe的fetch\n   * 3、准备shadow\n   * 4、准备子应用注入\n   */\n  public async active(options: {\n    url: string;\n    sync?: boolean;\n    prefix?: { [key: string]: string };\n    template?: string;\n    el?: string | HTMLElement;\n    props?: { [key: string]: any };\n    alive?: boolean;\n    fetch?: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\n    replace?: (code: string) => string;\n  }): Promise<void> {\n    const { sync, url, el, template, props, alive, prefix, fetch, replace } = options;\n    this.url = url;\n    this.sync = sync;\n    this.alive = alive;\n    this.hrefFlag = false;\n    this.prefix = prefix ?? this.prefix;\n    this.replace = replace ?? this.replace;\n    this.provide.props = props ?? this.provide.props;\n    this.activeFlag = true;\n    // wait iframe init\n    await this.iframeReady;\n\n    // 处理子应用自定义fetch\n    // TODO fetch检验合法性\n    const iframeWindow = this.iframe.contentWindow;\n    const iframeFetch = fetch\n      ? (input: RequestInfo, init?: RequestInit) =>\n          fetch(typeof input === \"string\" ? getAbsolutePath(input, (this.proxyLocation as Location).href) : input, init)\n      : this.fetch;\n    if (iframeFetch) {\n      iframeWindow.fetch = iframeFetch;\n      this.fetch = iframeFetch;\n    }\n\n    // 处理子应用路由同步\n    if (this.execFlag && this.alive) {\n      // 当保活模式下子应用重新激活时，只需要将子应用路径同步回主应用\n      syncUrlToWindow(iframeWindow);\n    } else {\n      // 先将url同步回iframe，然后再同步回浏览器url\n      syncUrlToIframe(iframeWindow);\n      syncUrlToWindow(iframeWindow);\n    }\n\n    // inject template\n    this.template = template ?? this.template;\n\n    /* 降级处理 */\n    if (this.degrade) {\n      const iframeBody = rawDocumentQuerySelector.call(iframeWindow.document, \"body\") as HTMLElement;\n      const { iframe, container } = initRenderIframeAndContainer(this.id, el ?? iframeBody, this.degradeAttrs);\n      this.el = container;\n      // 销毁js运行iframe容器内部dom\n      if (el) clearChild(iframeBody);\n      // 修复vue的event.timeStamp问题\n      patchEventTimeStamp(iframe.contentWindow, iframeWindow);\n      // 当销毁iframe时主动unmount子应用\n      iframe.contentWindow.onunload = () => {\n        this.unmount();\n      };\n      if (this.document) {\n        if (this.alive) {\n          iframe.contentDocument.replaceChild(this.document.documentElement, iframe.contentDocument.documentElement);\n          // 保活场景需要事件全部恢复\n          recoverEventListeners(iframe.contentDocument.documentElement, iframeWindow);\n        } else {\n          await renderTemplateToIframe(iframe.contentDocument, this.iframe.contentWindow, this.template);\n          // 非保活场景需要恢复根节点的事件，防止react16监听事件丢失\n          recoverDocumentListeners(this.document.documentElement, iframe.contentDocument.documentElement, iframeWindow);\n        }\n      } else {\n        await renderTemplateToIframe(iframe.contentDocument, this.iframe.contentWindow, this.template);\n      }\n      this.document = iframe.contentDocument;\n      return;\n    }\n\n    if (this.shadowRoot) {\n      /*\n       document.addEventListener was transfer to shadowRoot.addEventListener\n       react 16 SyntheticEvent will remember document event for avoid repeat listen\n       shadowRoot have to dispatchEvent for react 16 so can't be destroyed\n       this may lead memory leak risk\n       */\n      this.el = renderElementToContainer(this.shadowRoot.host, el);\n      if (this.alive) return;\n    } else {\n      // 预执行无容器，暂时插入iframe内部触发Web Component的connect\n      const iframeBody = rawDocumentQuerySelector.call(iframeWindow.document, \"body\") as HTMLElement;\n      this.el = renderElementToContainer(createWujieWebComponent(this.id), el ?? iframeBody);\n    }\n\n    await renderTemplateToShadowRoot(this.shadowRoot, iframeWindow, this.template);\n    this.patchCssRules();\n\n    // inject shadowRoot to app\n    this.provide.shadowRoot = this.shadowRoot;\n  }\n\n  // 未销毁，空闲时才回调\n  public requestIdleCallback(callback) {\n    return requestIdleCallback(() => {\n      // 假如已经被销毁了\n      if (!this.iframe) return;\n      callback.apply(this);\n    });\n  }\n  /** 启动子应用\n   * 1、运行js\n   * 2、处理兼容样式\n   */\n  public async start(getExternalScripts: () => ScriptResultList): Promise<void> {\n    this.execFlag = true;\n    // 执行脚本\n    const scriptResultList = await getExternalScripts();\n    // 假如已经被销毁了\n    if (!this.iframe) return;\n    const iframeWindow = this.iframe.contentWindow;\n    // 标志位，执行代码前设置\n    iframeWindow.__POWERED_BY_WUJIE__ = true;\n    // 用户自定义代码前\n    const beforeScriptResultList: ScriptObjectLoader[] = getPresetLoaders(\"jsBeforeLoaders\", this.plugins);\n    // 用户自定义代码后\n    const afterScriptResultList: ScriptObjectLoader[] = getPresetLoaders(\"jsAfterLoaders\", this.plugins);\n    // 同步代码\n    const syncScriptResultList: ScriptResultList = [];\n    // async代码无需保证顺序，所以不用放入执行队列\n    const asyncScriptResultList: ScriptResultList = [];\n    // defer代码需要保证顺序并且DOMContentLoaded前完成，这里统一放置同步脚本后执行\n    const deferScriptResultList: ScriptResultList = [];\n    scriptResultList.forEach((scriptResult) => {\n      if (scriptResult.defer) deferScriptResultList.push(scriptResult);\n      else if (scriptResult.async) asyncScriptResultList.push(scriptResult);\n      else syncScriptResultList.push(scriptResult);\n    });\n\n    // 插入代码前\n    beforeScriptResultList.forEach((beforeScriptResult) => {\n      this.execQueue.push(() =>\n        this.fiber\n          ? this.requestIdleCallback(() => insertScriptToIframe(beforeScriptResult, iframeWindow))\n          : insertScriptToIframe(beforeScriptResult, iframeWindow)\n      );\n    });\n\n    // 同步代码\n    syncScriptResultList.concat(deferScriptResultList).forEach((scriptResult) => {\n      this.execQueue.push(() =>\n        scriptResult.contentPromise.then((content) =>\n          this.fiber\n            ? this.requestIdleCallback(() => insertScriptToIframe({ ...scriptResult, content }, iframeWindow))\n            : insertScriptToIframe({ ...scriptResult, content }, iframeWindow)\n        )\n      );\n    });\n\n    // 异步代码\n    asyncScriptResultList.forEach((scriptResult) => {\n      scriptResult.contentPromise.then((content) => {\n        this.fiber\n          ? this.requestIdleCallback(() => insertScriptToIframe({ ...scriptResult, content }, iframeWindow))\n          : insertScriptToIframe({ ...scriptResult, content }, iframeWindow);\n      });\n    });\n\n    //框架主动调用mount方法\n    this.execQueue.push(this.fiber ? () => this.requestIdleCallback(() => this.mount()) : () => this.mount());\n\n    //触发 DOMContentLoaded 事件\n    const domContentLoadedTrigger = () => {\n      eventTrigger(iframeWindow.document, \"DOMContentLoaded\");\n      eventTrigger(iframeWindow, \"DOMContentLoaded\");\n      this.execQueue.shift()?.();\n    };\n    this.execQueue.push(this.fiber ? () => this.requestIdleCallback(domContentLoadedTrigger) : domContentLoadedTrigger);\n\n    // 插入代码后\n    afterScriptResultList.forEach((afterScriptResult) => {\n      this.execQueue.push(() =>\n        this.fiber\n          ? this.requestIdleCallback(() => insertScriptToIframe(afterScriptResult, iframeWindow))\n          : insertScriptToIframe(afterScriptResult, iframeWindow)\n      );\n    });\n\n    //触发 loaded 事件\n    const domLoadedTrigger = () => {\n      eventTrigger(iframeWindow.document, \"readystatechange\");\n      eventTrigger(iframeWindow, \"load\");\n      this.execQueue.shift()?.();\n    };\n    this.execQueue.push(this.fiber ? () => this.requestIdleCallback(domLoadedTrigger) : domLoadedTrigger);\n    // 由于没有办法准确定位是哪个代码做了mount，保活、重建模式提前关闭loading\n    if (this.alive || !isFunction(this.iframe.contentWindow.__WUJIE_UNMOUNT)) removeLoading(this.el);\n    this.execQueue.shift()();\n\n    // 所有的execQueue队列执行完毕，start才算结束，保证串行的执行子应用\n    return new Promise((resolve) => {\n      this.execQueue.push(() => {\n        resolve();\n        this.execQueue.shift()?.();\n      });\n    });\n  }\n\n  /**\n   * 框架主动发起mount，如果子应用是异步渲染实例，比如将生命周__WUJIE_MOUNT放到async函数内\n   * 此时如果采用fiber模式渲染（主应用调用mount的时机也是异步不确定的），框架调用mount时可能\n   * 子应用的__WUJIE_MOUNT还没有挂载到window，所以这里封装一个mount函数，当子应用是异步渲染\n   * 实例时，子应用异步函数里面最后加上window.__WUJIE.mount()来主动调用\n   */\n  public mount(): void {\n    if (this.mountFlag) return;\n    if (isFunction(this.iframe.contentWindow.__WUJIE_MOUNT)) {\n      removeLoading(this.el);\n      this.lifecycles?.beforeMount?.(this.iframe.contentWindow);\n      this.iframe.contentWindow.__WUJIE_MOUNT();\n      this.lifecycles?.afterMount?.(this.iframe.contentWindow);\n      this.mountFlag = true;\n    }\n    if (this.alive) {\n      this.lifecycles?.activated?.(this.iframe.contentWindow);\n    }\n    this.execQueue.shift()?.();\n  }\n\n  /** 保活模式和使用proxyLocation.href跳转链接都不应该销毁shadow */\n  public async unmount(): Promise<void> {\n    this.activeFlag = false;\n    // 清理子应用过期的同步参数\n    clearInactiveAppUrl();\n    if (this.alive) {\n      this.lifecycles?.deactivated?.(this.iframe.contentWindow);\n    }\n    if (!this.mountFlag) return;\n    if (isFunction(this.iframe.contentWindow.__WUJIE_UNMOUNT) && !this.alive && !this.hrefFlag) {\n      this.lifecycles?.beforeUnmount?.(this.iframe.contentWindow);\n      await this.iframe.contentWindow.__WUJIE_UNMOUNT();\n      this.lifecycles?.afterUnmount?.(this.iframe.contentWindow);\n      this.mountFlag = false;\n      this.bus?.$clear();\n      if (!this.degrade) {\n        clearChild(this.shadowRoot);\n        // head body需要复用，每次都要清空事件\n        removeEventListener(this.head);\n        removeEventListener(this.body);\n      }\n      clearChild(this.head);\n      clearChild(this.body);\n    }\n  }\n\n  /** 销毁子应用 */\n  public async destroy() {\n    await this.unmount();\n    this.bus.$clear();\n    this.shadowRoot = null;\n    this.proxy = null;\n    this.proxyDocument = null;\n    this.proxyLocation = null;\n    this.execQueue = null;\n    this.provide = null;\n    this.degradeAttrs = null;\n    this.styleSheetElements = null;\n    this.bus = null;\n    this.replace = null;\n    this.fetch = null;\n    this.execFlag = null;\n    this.mountFlag = null;\n    this.hrefFlag = null;\n    this.document = null;\n    this.head = null;\n    this.body = null;\n    this.elementEventCacheMap = null;\n    this.lifecycles = null;\n    this.plugins = null;\n    this.provide = null;\n    this.inject = null;\n    this.execQueue = null;\n    this.prefix = null;\n    this.iframeAddEventListeners = null;\n    this.iframeOnEvents = null;\n    // 清除 dom\n    if (this.el) {\n      clearChild(this.el);\n      this.el = null;\n    }\n    // 清除 iframe 沙箱\n    if (this.iframe) {\n      const iframeWindow = this.iframe.contentWindow;\n      if (iframeWindow?.__WUJIE_EVENTLISTENER__) {\n        iframeWindow.__WUJIE_EVENTLISTENER__.forEach((o) => {\n          iframeWindow.removeEventListener(o.type, o.listener, o.options);\n        });\n      }\n      this.iframe.parentNode?.removeChild(this.iframe);\n      this.iframe = null;\n    }\n    deleteWujieById(this.id);\n  }\n\n  /** 当子应用再次激活后，只运行mount函数，样式需要重新恢复 */\n  public rebuildStyleSheets(): void {\n    if (this.styleSheetElements && this.styleSheetElements.length) {\n      this.styleSheetElements.forEach((styleSheetElement) => {\n        rawElementAppendChild.call(this.degrade ? this.document.head : this.shadowRoot.head, styleSheetElement);\n      });\n    }\n    this.patchCssRules();\n  }\n\n  /**\n   * 子应用样式打补丁\n   * 1、兼容:root选择器样式到:host选择器上\n   * 2、将@font-face定义到shadowRoot外部\n   */\n  public patchCssRules(): void {\n    if (this.degrade) return;\n    if (this.shadowRoot.host.hasAttribute(WUJIE_DATA_ATTACH_CSS_FLAG)) return;\n    const [hostStyleSheetElement, fontStyleSheetElement] = getPatchStyleElements(\n      Array.from(this.iframe.contentDocument.querySelectorAll(\"style\")).map(\n        (styleSheetElement) => styleSheetElement.sheet\n      )\n    );\n    if (hostStyleSheetElement) {\n      this.shadowRoot.head.appendChild(hostStyleSheetElement);\n      this.styleSheetElements.push(hostStyleSheetElement);\n    }\n    if (fontStyleSheetElement) {\n      this.shadowRoot.host.appendChild(fontStyleSheetElement);\n    }\n    (hostStyleSheetElement || fontStyleSheetElement) &&\n      this.shadowRoot.host.setAttribute(WUJIE_DATA_ATTACH_CSS_FLAG, \"\");\n  }\n\n  /**\n   * @param id 子应用的id，唯一标识\n   * @param url 子应用的url，可以包含protocol、host、path、query、hash\n   */\n  constructor(options: {\n    name: string;\n    url: string;\n    attrs: { [key: string]: any };\n    degradeAttrs: { [key: string]: any };\n    fiber: boolean;\n    degrade;\n    plugins: Array<plugin>;\n    lifecycles: lifecycles;\n    iframeAddEventListeners?: Array<string>;\n    iframeOnEvents?: Array<string>;\n  }) {\n    // 传递inject给嵌套子应用\n    if (window.__POWERED_BY_WUJIE__) this.inject = window.__WUJIE.inject;\n    else {\n      this.inject = {\n        idToSandboxMap: idToSandboxCacheMap,\n        appEventObjMap,\n        mainHostPath: window.location.protocol + \"//\" + window.location.host,\n      };\n    }\n    const { name, url, attrs, fiber, degradeAttrs, degrade, lifecycles, plugins } = options;\n    this.id = name;\n    this.fiber = fiber;\n    this.degrade = degrade || !wujieSupport;\n    this.bus = new EventBus(this.id);\n    this.url = url;\n    this.degradeAttrs = degradeAttrs;\n    this.provide = { bus: this.bus };\n    this.styleSheetElements = [];\n    this.execQueue = [];\n    this.lifecycles = lifecycles;\n    this.plugins = getPlugins(plugins);\n    this.iframeAddEventListeners = options.iframeAddEventListeners;\n    this.iframeOnEvents = options.iframeOnEvents;\n\n    // 创建目标地址的解析\n    const { urlElement, appHostPath, appRoutePath } = appRouteParse(url);\n    const { mainHostPath } = this.inject;\n    // 创建iframe\n    this.iframe = iframeGenerator(this, attrs, mainHostPath, appHostPath, appRoutePath);\n\n    if (this.degrade) {\n      const { proxyDocument, proxyLocation } = localGenerator(this.iframe, urlElement, mainHostPath, appHostPath);\n      this.proxyDocument = proxyDocument;\n      this.proxyLocation = proxyLocation;\n    } else {\n      const { proxyWindow, proxyDocument, proxyLocation } = proxyGenerator(\n        this.iframe,\n        urlElement,\n        mainHostPath,\n        appHostPath\n      );\n      this.proxy = proxyWindow;\n      this.proxyDocument = proxyDocument;\n      this.proxyLocation = proxyLocation;\n    }\n    this.provide.location = this.proxyLocation;\n\n    addSandboxCacheWithWujie(this.id, this);\n  }\n}\n"],"mappings":"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","ignoreList":[]}